<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
    <title>
    {{script_name}}脚本运行报告
    </title>
    
    <!--[if lt IE 9]>
    <script src="https://css3-mediaqueries-js.googlecode.com/svn/trunk/css3-mediaqueries.js"></script>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    

    <link href="{{static_root}}css/bootstrap.min.css" rel="stylesheet">
    <link href="{{static_root}}css/main.css" rel="stylesheet">

    <link href="{{static_root}}css/report.css" rel="stylesheet">
    <link href="{{static_root}}css/jquery.fancybox.css" rel="stylesheet">
    <link href="{{static_root}}css/animate.css" rel="stylesheet">

    <style>
    h2.header {
      background-color: #3498db;
      color:white;
      padding: 10px;
      margin-bottom: 10px;
    }

    h2 {
      font-size: 25px;
    }

    body {
      overflow-x: hidden;
    }

    div.screen_holder {
      /*position: relative;*/
      position: absolute;
      margin-top: 10px;
    }

    div.screen_holder img {
      /*max-height: 600px;*/
    }

    img.crop_image {
      display: block;
    }

    img.spot {
      position: absolute;
      width:50px;
      height:50px;
      margin-left: -25px;
      margin-top: -25px;
    }

    p.desc {
      font-weight: bold;
      font-size: 16px;
    }

    .moa label {
      font-size: 16px;
    }

    .moa .point {
      font-size: 20px;
      padding: 10px;
      display: inline-block;
    }

    pre {
      background-color: #23241f;
    }

    img.error-img {
      max-width: 70px !important;
    }

    .ztree span.glyphicon {
      color: red;
    }

    .scale {
      transform-origin:top left;
    }

    #main {
      min-height: 600px;
    }

    .fast-nav-step {
      position: fixed;
      right: 30px;
      bottom: 10px;
      z-index: 10;
      padding: 10px 20px;
      background: rgba(222,222,222,0.8);
    }

    .fast-nav-step label {
      display: block;
      border-bottom: 1px solid #7f8c8d;
      padding-bottom: 6px;
      margin-bottom: 12px;
      color: #34495e;
    }

    .a-circle {
      display: inline-block;
      width: 30px;
      height: 30px;
      border-radius: 25px;

      padding-top: 4px;

      text-align: center;
      color: white; 
      box-shadow: 0 2px 5px 0 rgba(0, 0, 0, 0.16), 0 2px 10px 0 rgba(0, 0, 0, 0.12);
    }
    
    .fast-nav-step .a-circle:hover {
      opacity: 0.9;
      box-shadow: 0 5px 11px 0 rgba(0, 0, 0, 0.18), 0 4px 15px 0 rgba(0, 0, 0, 0.15);    
    }

    div.assert {
      padding-left: 20px;
    }

    </style>

  </head>

  <body>

    <div class="container-fluid" style="max-width:1400px;">
      <div class="row">
        <div id="main" class="main col-md-12">

          {% if not steps %}
          <h2>你没有眼花，这个Log文件就是一片空白</h2>
          {% endif %}

          <div class="material moa" >
            <h2>测试用例 {{script_name}}            
              {% if test_result %}
              <label class="green">[测试成功]</label>
              {% else %}
              <label class="red">[测试失败]</label>
              {% endif %}
            </h2>

            <h4>{{run_start}} -- {{run_end}}</h4>

            <h2 class="header">Assert 测试点汇总</h2>
            <hr>
            <div class="row">
            {% for step in steps %}
              {% if step.assert %}
              <div class="col-xs-4 assert">
                测试点 <a class="a-circle bg-green" href="#{{loop.index}}">{{loop.index}}</a> 预期结果:{{step.assert}}
              </div>
              {% endif %}
            {% endfor %}
            </div>
          </div>

          {% for step in steps %}
          <div class="material moa" data-trace="{{step.trace}}" id="{{loop.index}}">

            <h2 class="header">Step {{loop.index}} <span class="step_title">{{step.title}}</span> <span class="step_title">[{{step.start_time}}]</span></h2>
            <hr>
            {% if step.type in img_type %}
            <div class="row">
              <div class="col-xs-3">
                <div class="point">
                  <span class="glyphicon glyphicon-play"></span>
                </div>
                <label>目标图片</label>
              </div>
              <div class="col-xs-9">
                <img class="crop_image" src="{{step.image_to_find}}" title="{{step.image_to_find}}">
              </div>
            </div>
            <div class="row">  
              <div class="col-xs-3">
                <div class="point">
                  <span class="glyphicon glyphicon-play"></span>
                </div>
                <label>运行时屏幕截图</label>
              </div>
              <!-- scale移除文档流， 使用js对screen_place赋值高度来占位 -->
              <div class="col-xs-9">
                <div class="screen_holder">
                  <img class="fancybox scale" src="{{step.screenshot}}" title="{{step.screenshot}}">
                  {% if not step.trace and step.target_pos %}
                  <img class="spot animated infinite rubberBand" src="{{static_root}}image/target.png" data-top="{{step.top}}" data-left="{{step.left}}" style="top:{{step.top}}px;left:{{step.left}}px;">
                  {% endif %}
                </div>
                <div class="screen_place"></div>
              </div>  
            </div> 
            <p class="desc"><span class="point glyphicon glyphicon-play"></span>{{step.desc}}</p>
            {% else %}
            <p class="desc"><span class="point glyphicon glyphicon-play"></span>{{step.desc}}</p>
            {% endif %}

            {% if not step.trace %}            
            <div class="alert alert-success">
              <span class="glyphicon glyphicon-ok"></span>
              执行成功
            </div>
            {% else %}
            <div class="alert alert-danger">
              <span class="glyphicon glyphicon-alert"></span>
              执行失败
            </div>
            
            <div>
              <pre><code class="python">
{{step.traceback}}            
              </code></pre>
            </div>
            {% endif %}
          </div>
          {% endfor %}

          <!-- 导航栏 -->
          <div class="fast-nav-step">
            <label>步骤导航</label>
            {% for step in steps %}
              {% if step.trace %}
              <a class="a-circle bg-red" href="#{{loop.index}}">{{loop.index}}</a>
              {% else %}
              <a class="a-circle bg-green" href="#{{loop.index}}">{{loop.index}}</a>
              {% endif %}
            {% endfor %}
            <a class="a-circle bg-green" href="#">Top</a>
          </div>


        </div>
      </div>  
    </div>
  
    {% block footer %}
    <div class="footer">
      相关信息
    </div> 
    {% endblock %}
  
  <script src="{{static_root}}js/jquery-1.10.2.min.js"></script>
  <script src="{{static_root}}js/bootstrap.min.js"></script>

  <!-- hightlight js -->
  <link href="{{static_root}}css/monokai_sublime.min.css" rel="stylesheet">  
  <script src="{{static_root}}js/highlight.min.js"></script>  
  <script >hljs.initHighlightingOnLoad();</script>

  <script>

  $(function(){
    var scale = {{scale}};

    $("img").error(function () {
      var orsrc = $(this).attr("src")
      if(!orsrc){ return }

      $(this).unbind("error")
      .addClass('error-img')
      .attr("src", "{{ static_root }}image/broken.png")
      .attr("orgin-src", orsrc);
    });

    $(".screen_holder").find("img.fancybox").load(function(e){
      scale_img(scale);
    })

    function scale_img(i){
      $(".screen_holder").find("img.fancybox").each(function(e){
        var h = $(this).height();
        var sc = 'scale('+ i +','+ i +')';
        
        $(this).css({
          '-ms-transform': sc,
          '-webkit-transform': sc,
          '-moz-transform': sc,
          'transform': sc,
        })

        var sp = $(this).siblings('img.spot');
        var top = sp.data('top');
        var left = sp.data('left');

        sp.css({
          'top':top*i,
          'left':left*i,
        })

        $(this).parents('.screen_holder').siblings('.screen_place').height(h*i);
      });
    }
    //resize img
    scale_img(scale);

    $(window).resize(function() {
      var ww = $('body').width();
      if (ww < 900){
        scale = 0.25;
      }
      else if (ww < 1100 ){
        scale = 0.3;
      }
      else if( ww < 1300){
        scale = 0.4;  
      }else{
        scale = 0.5;
      }
      scale_img(scale)
    });
    $(window).resize();
  });
  </script>

  <script>
  $(window).resize();
  </script>

  </body>
</html>



