

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>airtest.report.images2gif.images2gif &mdash; airtest  documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../../search.html"/>
    <link rel="top" title="airtest  documentation" href="../../../../index.html"/>
        <link rel="up" title="Module code" href="../../../index.html"/> 

  
  <script src="../../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../../index.html" class="icon icon-home"> airtest
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../README.html">Airtest</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../README.html#features">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../README.html#install">Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../README.html#use-as-a-python-package">Use as a python package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../README.html#command-line-usage">Command line usage</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../all_module/airtest.core.main.html">airtest.core.main module</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../all_module/airtest.core.android.html">airtest.core.android package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../all_module/airtest.core.ios.html">airtest.core.ios package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../all_module/airtest.core.win.html">airtest.core.win package</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../all_module/airtest.html">airtest package</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">airtest</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
      <li>airtest.report.images2gif.images2gif</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for airtest.report.images2gif.images2gif</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1">#   Copyright (C) 2012, Almar Klein, Ant1, Marius van Voorden</span>
<span class="c1">#</span>
<span class="c1">#   This code is subject to the (new) BSD license:</span>
<span class="c1">#</span>
<span class="c1">#   Redistribution and use in source and binary forms, with or without</span>
<span class="c1">#   modification, are permitted provided that the following conditions are met:</span>
<span class="c1">#     * Redistributions of source code must retain the above copyright</span>
<span class="c1">#       notice, this list of conditions and the following disclaimer.</span>
<span class="c1">#     * Redistributions in binary form must reproduce the above copyright</span>
<span class="c1">#       notice, this list of conditions and the following disclaimer in the</span>
<span class="c1">#       documentation and/or other materials provided with the distribution.</span>
<span class="c1">#     * Neither the name of the &lt;organization&gt; nor the</span>
<span class="c1">#       names of its contributors may be used to endorse or promote products</span>
<span class="c1">#       derived from this software without specific prior written permission.</span>
<span class="c1"># </span>
<span class="c1"># THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; </span>
<span class="c1"># AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span>
<span class="c1"># IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</span>
<span class="c1"># ARE DISCLAIMED. IN NO EVENT SHALL &lt;COPYRIGHT HOLDER&gt; BE LIABLE FOR ANY </span>
<span class="c1"># DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES</span>
<span class="c1"># (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;</span>
<span class="c1"># LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND</span>
<span class="c1"># ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span>
<span class="c1"># (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS</span>
<span class="c1"># SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>

<span class="sd">&quot;&quot;&quot; Module images2gif</span>

<span class="sd">Provides functionality for reading and writing animated GIF images.</span>
<span class="sd">Use writeGif to write a series of numpy arrays or PIL images as an </span>
<span class="sd">animated GIF. Use readGif to read an animated gif as a series of numpy</span>
<span class="sd">arrays.</span>

<span class="sd">Note that since July 2004, all patents on the LZW compression patent have</span>
<span class="sd">expired. Therefore the GIF format may now be used freely.</span>

<span class="sd">Acknowledgements</span>
<span class="sd">----------------</span>

<span class="sd">Many thanks to Ant1 for:</span>
<span class="sd">* noting the use of &quot;palette=PIL.Image.ADAPTIVE&quot;, which significantly</span>
<span class="sd">  improves the results. </span>
<span class="sd">* the modifications to save each image with its own palette, or optionally</span>
<span class="sd">  the global palette (if its the same).</span>

<span class="sd">Many thanks to Marius van Voorden for porting the NeuQuant quantization </span>
<span class="sd">algorithm of Anthony Dekker to Python (See the NeuQuant class for its</span>
<span class="sd">license).</span>

<span class="sd">Many thanks to Alex Robinson for implementing the concept of subrectangles,</span>
<span class="sd">which (depening on image content) can give a very significant reduction in</span>
<span class="sd">file size.</span>

<span class="sd">This code is based on gifmaker (in the scripts folder of the source </span>
<span class="sd">distribution of PIL)</span>


<span class="sd">Usefull links</span>
<span class="sd">-------------</span>
<span class="sd">  * http://tronche.com/computer-graphics/gif/</span>
<span class="sd">  * http://en.wikipedia.org/wiki/Graphics_Interchange_Format</span>
<span class="sd">  * http://www.w3.org/Graphics/GIF/spec-gif89a.txt</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="c1"># todo: This module should be part of imageio (or at least based on)</span>

<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">time</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">PIL</span>
    <span class="kn">from</span> <span class="nn">PIL</span> <span class="k">import</span> <span class="n">Image</span>
    <span class="kn">from</span> <span class="nn">PIL.GifImagePlugin</span> <span class="k">import</span> <span class="n">getheader</span><span class="p">,</span> <span class="n">getdata</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">PIL</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">np</span> <span class="o">=</span> <span class="kc">None</span>    

<div class="viewcode-block" id="get_cKDTree"><a class="viewcode-back" href="../../../../all_module/airtest.report.images2gif.images2gif.html#airtest.report.images2gif.images2gif.get_cKDTree">[docs]</a><span class="k">def</span> <span class="nf">get_cKDTree</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">scipy.spatial</span> <span class="k">import</span> <span class="n">cKDTree</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="n">cKDTree</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">cKDTree</span></div>


<span class="c1"># getheader gives a 87a header and a color palette (two elements in a list).</span>
<span class="c1"># getdata()[0] gives the Image Descriptor up to (including) &quot;LZW min code size&quot;.</span>
<span class="c1"># getdatas()[1:] is the image data itself in chuncks of 256 bytes (well</span>
<span class="c1"># technically the first byte says how many bytes follow, after which that</span>
<span class="c1"># amount (max 255) follows).</span>

<div class="viewcode-block" id="checkImages"><a class="viewcode-back" href="../../../../all_module/airtest.report.images2gif.images2gif.html#airtest.report.images2gif.images2gif.checkImages">[docs]</a><span class="k">def</span> <span class="nf">checkImages</span><span class="p">(</span><span class="n">images</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; checkImages(images)</span>
<span class="sd">    Check numpy images and correct intensity range etc.</span>
<span class="sd">    The same for all movie formats.</span>
<span class="sd">    &quot;&quot;&quot;</span> 
    <span class="c1"># Init results</span>
    <span class="n">images2</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">im</span> <span class="ow">in</span> <span class="n">images</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">PIL</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">PIL</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">):</span>
            <span class="c1"># We assume PIL images are allright</span>
            <span class="n">images2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
        
        <span class="k">elif</span> <span class="n">np</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="c1"># Check and convert dtype</span>
            <span class="k">if</span> <span class="n">im</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">:</span>
                <span class="n">images2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">im</span><span class="p">)</span> <span class="c1"># Ok</span>
            <span class="k">elif</span> <span class="n">im</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">in</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
                <span class="n">im</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">im</span><span class="p">[</span><span class="n">im</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">im</span><span class="p">[</span><span class="n">im</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">im</span> <span class="o">*=</span> <span class="mi">255</span>
                <span class="n">images2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">im</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span> <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">im</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
                <span class="n">images2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
            <span class="c1"># Check size</span>
            <span class="k">if</span> <span class="n">im</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">pass</span> <span class="c1"># ok</span>
            <span class="k">elif</span> <span class="n">im</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">im</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;This array can not represent an image.&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;This array can not represent an image.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Invalid image type: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">im</span><span class="p">)))</span>
    
    <span class="c1"># Done</span>
    <span class="k">return</span> <span class="n">images2</span></div>


<div class="viewcode-block" id="intToBin"><a class="viewcode-back" href="../../../../all_module/airtest.report.images2gif.images2gif.html#airtest.report.images2gif.images2gif.intToBin">[docs]</a><span class="k">def</span> <span class="nf">intToBin</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Integer to two bytes &quot;&quot;&quot;</span>
    <span class="c1"># devide in two parts (bytes)</span>
    <span class="n">i1</span> <span class="o">=</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">256</span>
    <span class="n">i2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="n">i</span><span class="o">/</span><span class="mi">256</span><span class="p">)</span>
    <span class="c1"># make string (little endian)</span>
    <span class="k">return</span> <span class="nb">chr</span><span class="p">(</span><span class="n">i1</span><span class="p">)</span> <span class="o">+</span> <span class="nb">chr</span><span class="p">(</span><span class="n">i2</span><span class="p">)</span></div>


<div class="viewcode-block" id="GifWriter"><a class="viewcode-back" href="../../../../all_module/airtest.report.images2gif.images2gif.html#airtest.report.images2gif.images2gif.GifWriter">[docs]</a><span class="k">class</span> <span class="nc">GifWriter</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; GifWriter()</span>
<span class="sd">    </span>
<span class="sd">    Class that contains methods for helping write the animated GIF file.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
<div class="viewcode-block" id="GifWriter.getheaderAnim"><a class="viewcode-back" href="../../../../all_module/airtest.report.images2gif.images2gif.html#airtest.report.images2gif.images2gif.GifWriter.getheaderAnim">[docs]</a>    <span class="k">def</span> <span class="nf">getheaderAnim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">im</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; getheaderAnim(im)</span>
<span class="sd">        </span>
<span class="sd">        Get animation header. To replace PILs getheader()[0] </span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bb</span> <span class="o">=</span> <span class="s2">&quot;GIF89a&quot;</span>
        <span class="n">bb</span> <span class="o">+=</span> <span class="n">intToBin</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">bb</span> <span class="o">+=</span> <span class="n">intToBin</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">bb</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\x87\x00\x00</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">bb</span></div>
    
    
<div class="viewcode-block" id="GifWriter.getImageDescriptor"><a class="viewcode-back" href="../../../../all_module/airtest.report.images2gif.images2gif.html#airtest.report.images2gif.images2gif.GifWriter.getImageDescriptor">[docs]</a>    <span class="k">def</span> <span class="nf">getImageDescriptor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">im</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; getImageDescriptor(im, xy=None)</span>
<span class="sd">        </span>
<span class="sd">        Used for the local color table properties per image.</span>
<span class="sd">        Otherwise global color table applies to all frames irrespective of</span>
<span class="sd">        whether additional colors comes in play that require a redefined</span>
<span class="sd">        palette. Still a maximum of 256 color per frame, obviously.</span>
<span class="sd">        </span>
<span class="sd">        Written by Ant1 on 2010-08-22</span>
<span class="sd">        Modified by Alex Robinson in Janurari 2011 to implement subrectangles.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Defaule use full image and place at upper left</span>
        <span class="k">if</span> <span class="n">xy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xy</span>  <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        
        <span class="c1"># Image separator,</span>
        <span class="n">bb</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\x2C</span><span class="s1">&#39;</span> 
        
        <span class="c1"># Image position and size</span>
        <span class="n">bb</span> <span class="o">+=</span> <span class="n">intToBin</span><span class="p">(</span> <span class="n">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span> <span class="c1"># Left position</span>
        <span class="n">bb</span> <span class="o">+=</span> <span class="n">intToBin</span><span class="p">(</span> <span class="n">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span> <span class="c1"># Top position</span>
        <span class="n">bb</span> <span class="o">+=</span> <span class="n">intToBin</span><span class="p">(</span> <span class="n">im</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span> <span class="c1"># image width</span>
        <span class="n">bb</span> <span class="o">+=</span> <span class="n">intToBin</span><span class="p">(</span> <span class="n">im</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span> <span class="c1"># image height</span>
        
        <span class="c1"># packed field: local color table flag1, interlace0, sorted table0, </span>
        <span class="c1"># reserved00, lct size111=7=2^(7+1)=256.</span>
        <span class="n">bb</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\x87</span><span class="s1">&#39;</span> 
        
        <span class="c1"># LZW minimum size code now comes later, begining of [image data] blocks</span>
        <span class="k">return</span> <span class="n">bb</span></div>
    
    
<div class="viewcode-block" id="GifWriter.getAppExt"><a class="viewcode-back" href="../../../../all_module/airtest.report.images2gif.images2gif.html#airtest.report.images2gif.images2gif.GifWriter.getAppExt">[docs]</a>    <span class="k">def</span> <span class="nf">getAppExt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loops</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot; getAppExt(loops=float(&#39;inf&#39;))</span>
<span class="sd">        </span>
<span class="sd">        Application extention. This part specifies the amount of loops.</span>
<span class="sd">        If loops is 0 or inf, it goes on infinitely.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">loops</span><span class="o">==</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">loops</span><span class="o">==</span><span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">):</span>
            <span class="n">loops</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="mi">16</span><span class="o">-</span><span class="mi">1</span>
            <span class="c1">#bb = &quot;&quot; # application extension should not be used</span>
                    <span class="c1"># (the extension interprets zero loops</span>
                    <span class="c1"># to mean an infinite number of loops)</span>
                    <span class="c1"># Mmm, does not seem to work</span>
        <span class="k">if</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">bb</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\x21\xFF\x0B</span><span class="s2">&quot;</span>  <span class="c1"># application extension</span>
            <span class="n">bb</span> <span class="o">+=</span> <span class="s2">&quot;NETSCAPE2.0&quot;</span>
            <span class="n">bb</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\x03\x01</span><span class="s2">&quot;</span>
            <span class="n">bb</span> <span class="o">+=</span> <span class="n">intToBin</span><span class="p">(</span><span class="n">loops</span><span class="p">)</span>
            <span class="n">bb</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span>  <span class="c1"># end</span>
        <span class="k">return</span> <span class="n">bb</span></div>
    
    
<div class="viewcode-block" id="GifWriter.getGraphicsControlExt"><a class="viewcode-back" href="../../../../all_module/airtest.report.images2gif.images2gif.html#airtest.report.images2gif.images2gif.GifWriter.getGraphicsControlExt">[docs]</a>    <span class="k">def</span> <span class="nf">getGraphicsControlExt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">dispose</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">transparent_flag</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">transparency_index</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; getGraphicsControlExt(duration=0.1, dispose=2)</span>
<span class="sd">        </span>
<span class="sd">        Graphics Control Extension. A sort of header at the start of</span>
<span class="sd">        each image. Specifies duration and transparancy. </span>
<span class="sd">        </span>
<span class="sd">        Dispose</span>
<span class="sd">        -------</span>
<span class="sd">          * 0 - No disposal specified.</span>
<span class="sd">          * 1 - Do not dispose. The graphic is to be left in place.</span>
<span class="sd">          * 2 -	Restore to background color. The area used by the graphic </span>
<span class="sd">            must be restored to the background color.</span>
<span class="sd">          * 3 -	Restore to previous. The decoder is required to restore the</span>
<span class="sd">            area overwritten by the graphic with what was there prior to </span>
<span class="sd">            rendering the graphic.</span>
<span class="sd">          * 4-7 -To be defined. </span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">bb</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\x21\xF9\x04</span><span class="s1">&#39;</span>
        <span class="n">bb</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(((</span><span class="n">dispose</span> <span class="o">&amp;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="n">transparent_flag</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">))</span>  <span class="c1"># low bit 1 == transparency,</span>
        <span class="c1"># 2nd bit 1 == user input , next 3 bits, the low two of which are used,</span>
        <span class="c1"># are dispose.</span>
        <span class="n">bb</span> <span class="o">+=</span> <span class="n">intToBin</span><span class="p">(</span> <span class="nb">int</span><span class="p">(</span><span class="n">duration</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span> <span class="p">)</span> <span class="c1"># in 100th of seconds</span>
        <span class="n">bb</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">transparency_index</span><span class="p">)</span>  <span class="c1"># transparency index</span>
        <span class="n">bb</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span>  <span class="c1"># end</span>
        <span class="k">return</span> <span class="n">bb</span></div>
    
    
<div class="viewcode-block" id="GifWriter.handleSubRectangles"><a class="viewcode-back" href="../../../../all_module/airtest.report.images2gif.images2gif.html#airtest.report.images2gif.images2gif.GifWriter.handleSubRectangles">[docs]</a>    <span class="k">def</span> <span class="nf">handleSubRectangles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">images</span><span class="p">,</span> <span class="n">subRectangles</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; handleSubRectangles(images)</span>
<span class="sd">        </span>
<span class="sd">        Handle the sub-rectangle stuff. If the rectangles are given by the </span>
<span class="sd">        user, the values are checked. Otherwise the subrectangles are</span>
<span class="sd">        calculated automatically.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span> 
        <span class="n">image_info</span> <span class="o">=</span> <span class="p">[</span><span class="n">im</span><span class="o">.</span><span class="n">info</span> <span class="k">for</span> <span class="n">im</span> <span class="ow">in</span> <span class="n">images</span> <span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">subRectangles</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span><span class="nb">list</span><span class="p">)):</span>
            <span class="c1"># xy given directly</span>
            
            <span class="c1"># Check xy</span>
            <span class="n">xy</span> <span class="o">=</span> <span class="n">subRectangles</span>
            <span class="k">if</span> <span class="n">xy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">xy</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span> <span class="s1">&#39;__len__&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">xy</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">images</span><span class="p">):</span>
                    <span class="n">xy</span> <span class="o">=</span> <span class="p">[</span><span class="n">xxyy</span> <span class="k">for</span> <span class="n">xxyy</span> <span class="ow">in</span> <span class="n">xy</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;len(xy) doesn&#39;t match amount of images.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">xy</span> <span class="o">=</span> <span class="p">[</span><span class="n">xy</span> <span class="k">for</span> <span class="n">im</span> <span class="ow">in</span> <span class="n">images</span><span class="p">]</span>
            <span class="n">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Calculate xy using some basic image processing</span>
            
            <span class="c1"># Check Numpy</span>
            <span class="k">if</span> <span class="n">np</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Need Numpy to use auto-subRectangles.&quot;</span><span class="p">)</span>
            
            <span class="c1"># First make numpy arrays if required</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">images</span><span class="p">)):</span>
                <span class="n">im</span> <span class="o">=</span> <span class="n">images</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">):</span>
                    <span class="n">tmp</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span> <span class="c1"># Make without palette</span>
                    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">MemoryError</span><span class="p">(</span><span class="s2">&quot;Too little memory to convert PIL image to array&quot;</span><span class="p">)</span>
                    <span class="n">images</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span>
            
            <span class="c1"># Determine the sub rectangles</span>
            <span class="n">images</span><span class="p">,</span> <span class="n">xy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSubRectangles</span><span class="p">(</span><span class="n">images</span><span class="p">)</span>
        
        <span class="c1"># Done</span>
        <span class="k">return</span> <span class="n">images</span><span class="p">,</span> <span class="n">xy</span><span class="p">,</span> <span class="n">image_info</span></div>
    
    
<div class="viewcode-block" id="GifWriter.getSubRectangles"><a class="viewcode-back" href="../../../../all_module/airtest.report.images2gif.images2gif.html#airtest.report.images2gif.images2gif.GifWriter.getSubRectangles">[docs]</a>    <span class="k">def</span> <span class="nf">getSubRectangles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ims</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; getSubRectangles(ims)</span>
<span class="sd">        </span>
<span class="sd">        Calculate the minimal rectangles that need updating each frame.</span>
<span class="sd">        Returns a two-element tuple containing the cropped images and a</span>
<span class="sd">        list of x-y positions.</span>
<span class="sd">        </span>
<span class="sd">        Calculating the subrectangles takes extra time, obviously. However,</span>
<span class="sd">        if the image sizes were reduced, the actual writing of the GIF</span>
<span class="sd">        goes faster. In some cases applying this method produces a GIF faster.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Check image count</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ims</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ims</span><span class="p">,</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ims</span><span class="p">]</span>
        
        <span class="c1"># We need numpy</span>
        <span class="k">if</span> <span class="n">np</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Need Numpy to calculate sub-rectangles. &quot;</span><span class="p">)</span>
        
        <span class="c1"># Prepare</span>
        <span class="n">ims2</span> <span class="o">=</span> <span class="p">[</span><span class="n">ims</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">xy</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)]</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        
        <span class="c1"># Iterate over images</span>
        <span class="n">prev</span> <span class="o">=</span> <span class="n">ims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">im</span> <span class="ow">in</span> <span class="n">ims</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            
            <span class="c1"># Get difference, sum over colors</span>
            <span class="n">diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">im</span><span class="o">-</span><span class="n">prev</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">diff</span><span class="o">.</span><span class="n">ndim</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
                <span class="n">diff</span> <span class="o">=</span> <span class="n">diff</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  
            <span class="c1"># Get begin and end for both dimensions</span>
            <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">diff</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
            <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">diff</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
            <span class="c1"># Get rect coordinates</span>
            <span class="k">if</span> <span class="n">X</span><span class="o">.</span><span class="n">size</span> <span class="ow">and</span> <span class="n">Y</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
                <span class="n">x0</span><span class="p">,</span> <span class="n">x1</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
                <span class="n">y0</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">Y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span> <span class="c1"># No change ... make it minimal</span>
                <span class="n">x0</span><span class="p">,</span> <span class="n">x1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span>
                <span class="n">y0</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span>
            
            <span class="c1"># Cut out and store</span>
            <span class="n">im2</span> <span class="o">=</span> <span class="n">im</span><span class="p">[</span><span class="n">y0</span><span class="p">:</span><span class="n">y1</span><span class="p">,</span><span class="n">x0</span><span class="p">:</span><span class="n">x1</span><span class="p">]</span>
            <span class="n">prev</span> <span class="o">=</span> <span class="n">im</span>
            <span class="n">ims2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">im2</span><span class="p">)</span>
            <span class="n">xy</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">x0</span><span class="p">,</span><span class="n">y0</span><span class="p">))</span>
        
        <span class="c1"># Done</span>
        <span class="c1">#print(&#39;%1.2f seconds to determine subrectangles of  %i images&#39; % </span>
        <span class="c1">#    (time.time()-t0, len(ims2)) )</span>
        <span class="k">return</span> <span class="n">ims2</span><span class="p">,</span> <span class="n">xy</span></div>
    
    
<div class="viewcode-block" id="GifWriter.convertImagesToPIL"><a class="viewcode-back" href="../../../../all_module/airtest.report.images2gif.images2gif.html#airtest.report.images2gif.images2gif.GifWriter.convertImagesToPIL">[docs]</a>    <span class="k">def</span> <span class="nf">convertImagesToPIL</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">images</span><span class="p">,</span> <span class="n">dither</span><span class="p">,</span> <span class="n">nq</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">images_info</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; convertImagesToPIL(images, nq=0)</span>
<span class="sd">        </span>
<span class="sd">        Convert images to Paletted PIL images, which can then be </span>
<span class="sd">        written to a single animaged GIF.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Convert to PIL images</span>
        <span class="n">images2</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">im</span> <span class="ow">in</span> <span class="n">images</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">):</span>
                <span class="n">images2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">np</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">im</span><span class="o">.</span><span class="n">ndim</span><span class="o">==</span><span class="mi">3</span> <span class="ow">and</span> <span class="n">im</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
                    <span class="n">im</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">im</span><span class="p">,</span><span class="s1">&#39;RGB&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">im</span><span class="o">.</span><span class="n">ndim</span><span class="o">==</span><span class="mi">3</span> <span class="ow">and</span> <span class="n">im</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">==</span><span class="mi">4</span><span class="p">:</span>
                    <span class="c1"># im = Image.fromarray(im[:,:,:3],&#39;RGB&#39;)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">transparency</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">im</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">im</span><span class="p">[:,:,:</span><span class="mi">4</span><span class="p">],</span><span class="s1">&#39;RGBA&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">im</span><span class="o">.</span><span class="n">ndim</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
                    <span class="n">im</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">im</span><span class="p">,</span><span class="s1">&#39;L&#39;</span><span class="p">)</span>
                <span class="n">images2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
        
        <span class="c1"># Convert to paletted PIL images</span>
        <span class="n">images</span><span class="p">,</span> <span class="n">images2</span> <span class="o">=</span> <span class="n">images2</span><span class="p">,</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">nq</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># NeuQuant algorithm</span>
            <span class="k">for</span> <span class="n">im</span> <span class="ow">in</span> <span class="n">images</span><span class="p">:</span>
                <span class="n">im</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">&quot;RGBA&quot;</span><span class="p">)</span> <span class="c1"># NQ assumes RGBA</span>
                <span class="n">nqInstance</span> <span class="o">=</span> <span class="n">NeuQuant</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">nq</span><span class="p">))</span> <span class="c1"># Learn colors from image</span>
                <span class="k">if</span> <span class="n">dither</span><span class="p">:</span>
                    <span class="n">im</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">&quot;RGB&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">quantize</span><span class="p">(</span><span class="n">palette</span><span class="o">=</span><span class="n">nqInstance</span><span class="o">.</span><span class="n">paletteImage</span><span class="p">(),</span><span class="n">colors</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">im</span> <span class="o">=</span> <span class="n">nqInstance</span><span class="o">.</span><span class="n">quantize</span><span class="p">(</span><span class="n">im</span><span class="p">,</span><span class="n">colors</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>  <span class="c1"># Use to quantize the image itself</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">transparency</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># since NQ assumes transparency</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">transparency</span><span class="p">:</span>
                    <span class="n">alpha</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">3</span><span class="p">]</span>
                    <span class="n">mask</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="mi">255</span> <span class="k">if</span> <span class="n">a</span> <span class="o">&lt;=</span><span class="mi">128</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="n">im</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
                <span class="n">images2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Adaptive PIL algorithm</span>
            <span class="n">AD</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">ADAPTIVE</span>
            <span class="c1"># for index,im in enumerate(images):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">images</span><span class="p">)):</span>
                <span class="n">im</span> <span class="o">=</span> <span class="n">images</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s1">&#39;RGB&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">AD</span><span class="p">,</span> <span class="n">dither</span><span class="o">=</span><span class="n">dither</span><span class="p">,</span><span class="n">colors</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">transparency</span><span class="p">:</span>
                    <span class="n">alpha</span> <span class="o">=</span> <span class="n">images</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">3</span><span class="p">]</span>
                    <span class="n">mask</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="mi">255</span> <span class="k">if</span> <span class="n">a</span> <span class="o">&lt;=</span><span class="mi">128</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="n">im</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
                <span class="n">images2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
        
        <span class="c1"># Done</span>
        <span class="k">return</span> <span class="n">images2</span></div>
    
    
<div class="viewcode-block" id="GifWriter.writeGifToFile"><a class="viewcode-back" href="../../../../all_module/airtest.report.images2gif.images2gif.html#airtest.report.images2gif.images2gif.GifWriter.writeGifToFile">[docs]</a>    <span class="k">def</span> <span class="nf">writeGifToFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">images</span><span class="p">,</span> <span class="n">durations</span><span class="p">,</span> <span class="n">loops</span><span class="p">,</span> <span class="n">xys</span><span class="p">,</span> <span class="n">disposes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; writeGifToFile(fp, images, durations, loops, xys, disposes)</span>
<span class="sd">        </span>
<span class="sd">        Given a set of images writes the bytes to the specified stream.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Obtain palette for all images and count each occurance</span>
        <span class="n">palettes</span><span class="p">,</span> <span class="n">occur</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">im</span> <span class="ow">in</span> <span class="n">images</span><span class="p">:</span>
            <span class="c1"># palettes.append( getheader(im)[1] )</span>
            <span class="n">palettes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">palette</span><span class="o">.</span><span class="n">getdata</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">palette</span> <span class="ow">in</span> <span class="n">palettes</span><span class="p">:</span>
            <span class="n">occur</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">palettes</span><span class="o">.</span><span class="n">count</span><span class="p">(</span> <span class="n">palette</span> <span class="p">)</span> <span class="p">)</span>
        
        <span class="c1"># Select most-used palette as the global one (or first in case no max)</span>
        <span class="n">globalPalette</span> <span class="o">=</span> <span class="n">palettes</span><span class="p">[</span> <span class="n">occur</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">occur</span><span class="p">))</span> <span class="p">]</span>
        
        <span class="c1"># Init</span>
        <span class="n">frames</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">firstFrame</span> <span class="o">=</span> <span class="kc">True</span>
        
        
        <span class="k">for</span> <span class="n">im</span><span class="p">,</span> <span class="n">palette</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">palettes</span><span class="p">):</span>
        
            <span class="k">if</span> <span class="n">firstFrame</span><span class="p">:</span>
                <span class="c1"># Write header</span>
        
                <span class="c1"># Gather info</span>
                <span class="n">header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getheaderAnim</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
                <span class="n">appext</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getAppExt</span><span class="p">(</span><span class="n">loops</span><span class="p">)</span>
        
                <span class="c1"># Write</span>
                <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
                <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">globalPalette</span><span class="p">)</span>
                <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">appext</span><span class="p">)</span>
        
                <span class="c1"># Next frame is not the first</span>
                <span class="n">firstFrame</span> <span class="o">=</span> <span class="kc">False</span>
        
            <span class="k">if</span> <span class="kc">True</span><span class="p">:</span>
                <span class="c1"># Write palette and image data</span>
        
                <span class="c1"># Gather info</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">getdata</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
                <span class="n">imdes</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

                <span class="n">transparent_flag</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">transparency</span><span class="p">:</span> <span class="n">transparent_flag</span> <span class="o">=</span> <span class="mi">1</span>
                
                <span class="n">graphext</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getGraphicsControlExt</span><span class="p">(</span><span class="n">durations</span><span class="p">[</span><span class="n">frames</span><span class="p">],</span>
                                                        <span class="n">disposes</span><span class="p">[</span><span class="n">frames</span><span class="p">],</span><span class="n">transparent_flag</span><span class="o">=</span><span class="n">transparent_flag</span><span class="p">,</span><span class="n">transparency_index</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>

                <span class="c1"># Make image descriptor suitable for using 256 local color palette</span>
                <span class="n">lid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getImageDescriptor</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">xys</span><span class="p">[</span><span class="n">frames</span><span class="p">])</span>
        
                <span class="c1"># Write local header</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">palette</span> <span class="o">!=</span> <span class="n">globalPalette</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">disposes</span><span class="p">[</span><span class="n">frames</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">):</span>
                    <span class="c1"># Use local color palette</span>
                    <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">graphext</span><span class="p">)</span>
                    <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lid</span><span class="p">)</span> <span class="c1"># write suitable image descriptor</span>
                    <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">palette</span><span class="p">)</span> <span class="c1"># write local color table</span>
                    <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\x08</span><span class="s1">&#39;</span><span class="p">)</span> <span class="c1"># LZW minimum size code</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Use global color palette</span>
                    <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">graphext</span><span class="p">)</span>
                    <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">imdes</span><span class="p">)</span> <span class="c1"># write suitable image descriptor</span>
        
                <span class="c1"># Write image data</span>
                <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                    <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        
            <span class="c1"># Prepare for next round</span>
            <span class="n">frames</span> <span class="o">=</span> <span class="n">frames</span> <span class="o">+</span> <span class="mi">1</span>
        
        <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>  <span class="c1"># end gif</span>
        <span class="k">return</span> <span class="n">frames</span></div></div>
    



<span class="c1">## Exposed functions</span>

<div class="viewcode-block" id="writeGif"><a class="viewcode-back" href="../../../../all_module/airtest.report.images2gif.images2gif.html#airtest.report.images2gif.images2gif.writeGif">[docs]</a><span class="k">def</span> <span class="nf">writeGif</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">images</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">repeat</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dither</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                <span class="n">nq</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">subRectangles</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dispose</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; writeGif(filename, images, duration=0.1, repeat=True, dither=False,</span>
<span class="sd">                    nq=0, subRectangles=True, dispose=None)</span>
<span class="sd">    </span>
<span class="sd">    Write an animated gif from the specified images.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filename : string</span>
<span class="sd">        The name of the file to write the image to.</span>
<span class="sd">    images : list</span>
<span class="sd">        Should be a list consisting of PIL images or numpy arrays.</span>
<span class="sd">        The latter should be between 0 and 255 for integer types, and</span>
<span class="sd">        between 0 and 1 for float types.</span>
<span class="sd">    duration : scalar or list of scalars</span>
<span class="sd">        The duration for all frames, or (if a list) for each frame.</span>
<span class="sd">    repeat : bool or integer</span>
<span class="sd">        The amount of loops. If True, loops infinitetely.</span>
<span class="sd">    dither : bool</span>
<span class="sd">        Whether to apply dithering</span>
<span class="sd">    nq : integer</span>
<span class="sd">        If nonzero, applies the NeuQuant quantization algorithm to create</span>
<span class="sd">        the color palette. This algorithm is superior, but slower than</span>
<span class="sd">        the standard PIL algorithm. The value of nq is the quality</span>
<span class="sd">        parameter. 1 represents the best quality. 10 is in general a</span>
<span class="sd">        good tradeoff between quality and speed. When using this option, </span>
<span class="sd">        better results are usually obtained when subRectangles is False.</span>
<span class="sd">    subRectangles : False, True, or a list of 2-element tuples</span>
<span class="sd">        Whether to use sub-rectangles. If True, the minimal rectangle that</span>
<span class="sd">        is required to update each frame is automatically detected. This</span>
<span class="sd">        can give significant reductions in file size, particularly if only</span>
<span class="sd">        a part of the image changes. One can also give a list of x-y </span>
<span class="sd">        coordinates if you want to do the cropping yourself. The default</span>
<span class="sd">        is True.</span>
<span class="sd">    dispose : int</span>
<span class="sd">        How to dispose each frame. 1 means that each frame is to be left</span>
<span class="sd">        in place. 2 means the background color should be restored after</span>
<span class="sd">        each frame. 3 means the decoder should restore the previous frame.</span>
<span class="sd">        If subRectangles==False, the default is 2, otherwise it is 1.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Check PIL</span>
    <span class="k">if</span> <span class="n">PIL</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Need PIL to write animated gif files.&quot;</span><span class="p">)</span>
    
    <span class="c1"># Check images</span>
    <span class="n">images</span> <span class="o">=</span> <span class="n">checkImages</span><span class="p">(</span><span class="n">images</span><span class="p">)</span>

    <span class="c1"># Instantiate writer object</span>
    <span class="n">gifWriter</span> <span class="o">=</span> <span class="n">GifWriter</span><span class="p">()</span>
    <span class="n">gifWriter</span><span class="o">.</span><span class="n">transparency</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># init transparency flag used in GifWriter functions</span>
    
    <span class="c1"># Check loops</span>
    <span class="k">if</span> <span class="n">repeat</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">loops</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="n">repeat</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">loops</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># zero means infinite</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">loops</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">repeat</span><span class="p">)</span>
    
    <span class="c1"># Check duration</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">duration</span><span class="p">,</span> <span class="s1">&#39;__len__&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">duration</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">images</span><span class="p">):</span>
            <span class="n">duration</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">duration</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;len(duration) doesn&#39;t match amount of images.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">duration</span> <span class="o">=</span> <span class="p">[</span><span class="n">duration</span> <span class="k">for</span> <span class="n">im</span> <span class="ow">in</span> <span class="n">images</span><span class="p">]</span>
    
    <span class="c1"># Check subrectangles</span>
    <span class="k">if</span> <span class="n">subRectangles</span><span class="p">:</span>
        <span class="n">images</span><span class="p">,</span> <span class="n">xy</span><span class="p">,</span> <span class="n">images_info</span> <span class="o">=</span> <span class="n">gifWriter</span><span class="o">.</span><span class="n">handleSubRectangles</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">subRectangles</span><span class="p">)</span>
        <span class="n">defaultDispose</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># Leave image in place</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Normal mode</span>
        <span class="n">xy</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">im</span> <span class="ow">in</span> <span class="n">images</span><span class="p">]</span>
        <span class="n">defaultDispose</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># Restore to background color.</span>
    
    <span class="c1"># Check dispose</span>
    <span class="k">if</span> <span class="n">dispose</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dispose</span> <span class="o">=</span> <span class="n">defaultDispose</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dispose</span><span class="p">,</span> <span class="s1">&#39;__len__&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dispose</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">images</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;len(xy) doesn&#39;t match amount of images.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dispose</span> <span class="o">=</span> <span class="p">[</span><span class="n">dispose</span> <span class="k">for</span> <span class="n">im</span> <span class="ow">in</span> <span class="n">images</span><span class="p">]</span>
    
    <span class="c1"># Make images in a format that we can write easy</span>
    <span class="n">images</span> <span class="o">=</span> <span class="n">gifWriter</span><span class="o">.</span><span class="n">convertImagesToPIL</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">dither</span><span class="p">,</span> <span class="n">nq</span><span class="p">)</span>
    
    <span class="c1"># Write</span>
    <span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">gifWriter</span><span class="o">.</span><span class="n">writeGifToFile</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">images</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">loops</span><span class="p">,</span> <span class="n">xy</span><span class="p">,</span> <span class="n">dispose</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">fp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>



<div class="viewcode-block" id="readGif"><a class="viewcode-back" href="../../../../all_module/airtest.report.images2gif.images2gif.html#airtest.report.images2gif.images2gif.readGif">[docs]</a><span class="k">def</span> <span class="nf">readGif</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">asNumpy</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; readGif(filename, asNumpy=True)</span>
<span class="sd">    </span>
<span class="sd">    Read images from an animated GIF file.  Returns a list of numpy </span>
<span class="sd">    arrays, or, if asNumpy is false, a list if PIL images.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Check PIL</span>
    <span class="k">if</span> <span class="n">PIL</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Need PIL to read animated gif files.&quot;</span><span class="p">)</span>
    
    <span class="c1"># Check Numpy</span>
    <span class="k">if</span> <span class="n">np</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Need Numpy to read animated gif files.&quot;</span><span class="p">)</span>
    
    <span class="c1"># Check whether it exists</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;File not found: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
    
    <span class="c1"># Load file using PIL</span>
    <span class="n">pilIm</span> <span class="o">=</span> <span class="n">PIL</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>    
    <span class="n">pilIm</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="c1"># Read all images inside</span>
    <span class="n">images</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># Get image as numpy array</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="n">pilIm</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span> <span class="c1"># Make without palette</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">MemoryError</span><span class="p">(</span><span class="s2">&quot;Too little memory to convert PIL image to array&quot;</span><span class="p">)</span>
            <span class="c1"># Store, and next</span>
            <span class="n">images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
            <span class="n">pilIm</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">pilIm</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">EOFError</span><span class="p">:</span>
        <span class="k">pass</span>
    
    <span class="c1"># Convert to normal PIL images if needed</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">asNumpy</span><span class="p">:</span>
        <span class="n">images2</span> <span class="o">=</span> <span class="n">images</span>
        <span class="n">images</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">im</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">images2</span><span class="p">):</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="n">PIL</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
            <span class="n">images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
    
    <span class="c1"># Done</span>
    <span class="k">return</span> <span class="n">images</span></div>


<div class="viewcode-block" id="NeuQuant"><a class="viewcode-back" href="../../../../all_module/airtest.report.images2gif.images2gif.html#airtest.report.images2gif.images2gif.NeuQuant">[docs]</a><span class="k">class</span> <span class="nc">NeuQuant</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; NeuQuant(image, samplefac=10, colors=256)</span>
<span class="sd">    </span>
<span class="sd">    samplefac should be an integer number of 1 or higher, 1 </span>
<span class="sd">    being the highest quality, but the slowest performance. </span>
<span class="sd">    With avalue of 10, one tenth of all pixels are used during </span>
<span class="sd">    training. This value seems a nice tradeof between speed</span>
<span class="sd">    and quality.</span>
<span class="sd">    </span>
<span class="sd">    colors is the amount of colors to reduce the image to. This</span>
<span class="sd">    should best be a power of two.</span>
<span class="sd">    </span>
<span class="sd">    See also:</span>
<span class="sd">    http://members.ozemail.com.au/~dekker/NEUQUANT.HTML</span>
<span class="sd">    </span>
<span class="sd">    License of the NeuQuant Neural-Net Quantization Algorithm</span>
<span class="sd">    ---------------------------------------------------------</span>

<span class="sd">    Copyright (c) 1994 Anthony Dekker</span>
<span class="sd">    Ported to python by Marius van Voorden in 2010</span>

<span class="sd">    NEUQUANT Neural-Net quantization algorithm by Anthony Dekker, 1994.</span>
<span class="sd">    See &quot;Kohonen neural networks for optimal colour quantization&quot;</span>
<span class="sd">    in &quot;network: Computation in Neural Systems&quot; Vol. 5 (1994) pp 351-367.</span>
<span class="sd">    for a discussion of the algorithm.</span>
<span class="sd">    See also  http://members.ozemail.com.au/~dekker/NEUQUANT.HTML</span>

<span class="sd">    Any party obtaining a copy of these files from the author, directly or</span>
<span class="sd">    indirectly, is granted, free of charge, a full and unrestricted irrevocable,</span>
<span class="sd">    world-wide, paid up, royalty-free, nonexclusive right and license to deal</span>
<span class="sd">    in this software and documentation files (the &quot;Software&quot;), including without</span>
<span class="sd">    limitation the rights to use, copy, modify, merge, publish, distribute, sublicense,</span>
<span class="sd">    and/or sell copies of the Software, and to permit persons who receive</span>
<span class="sd">    copies from any such party to do so, with the only requirement being</span>
<span class="sd">    that this copyright notice remain intact.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">NCYCLES</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># Number of learning cycles</span>
    <span class="n">NETSIZE</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># Number of colours used</span>
    <span class="n">SPECIALS</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># Number of reserved colours used</span>
    <span class="n">BGCOLOR</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># Reserved background colour</span>
    <span class="n">CUTNETSIZE</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">MAXNETPOS</span> <span class="o">=</span> <span class="kc">None</span>
    
    <span class="n">INITRAD</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># For 256 colours, radius starts at 32</span>
    <span class="n">RADIUSBIASSHIFT</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">RADIUSBIAS</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">INITBIASRADIUS</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">RADIUSDEC</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># Factor of 1/30 each cycle</span>
    
    <span class="n">ALPHABIASSHIFT</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">INITALPHA</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># biased by 10 bits</span>
    
    <span class="n">GAMMA</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">BETA</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">BETAGAMMA</span> <span class="o">=</span> <span class="kc">None</span>
    
    <span class="n">network</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># The network itself</span>
    <span class="n">colormap</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># The network itself</span>
    
    <span class="n">netindex</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># For network lookup - really 256</span>
    
    <span class="n">bias</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># Bias and freq arrays for learning</span>
    <span class="n">freq</span> <span class="o">=</span> <span class="kc">None</span>
    
    <span class="n">pimage</span> <span class="o">=</span> <span class="kc">None</span>
    
    <span class="c1"># Four primes near 500 - assume no image has a length so large</span>
    <span class="c1"># that it is divisible by all four primes</span>
    <span class="n">PRIME1</span> <span class="o">=</span> <span class="mi">499</span>
    <span class="n">PRIME2</span> <span class="o">=</span> <span class="mi">491</span>
    <span class="n">PRIME3</span> <span class="o">=</span> <span class="mi">487</span>
    <span class="n">PRIME4</span> <span class="o">=</span> <span class="mi">503</span>
    <span class="n">MAXPRIME</span> <span class="o">=</span> <span class="n">PRIME4</span>
    
    <span class="n">pixels</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">samplefac</span> <span class="o">=</span> <span class="kc">None</span>
    
    <span class="n">a_s</span> <span class="o">=</span> <span class="kc">None</span>
    
    
<div class="viewcode-block" id="NeuQuant.setconstants"><a class="viewcode-back" href="../../../../all_module/airtest.report.images2gif.images2gif.html#airtest.report.images2gif.images2gif.NeuQuant.setconstants">[docs]</a>    <span class="k">def</span> <span class="nf">setconstants</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">samplefac</span><span class="p">,</span> <span class="n">colors</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NCYCLES</span> <span class="o">=</span> <span class="mi">100</span> <span class="c1"># Number of learning cycles</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NETSIZE</span> <span class="o">=</span> <span class="n">colors</span> <span class="c1"># Number of colours used</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SPECIALS</span> <span class="o">=</span> <span class="mi">3</span> <span class="c1"># Number of reserved colours used</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BGCOLOR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SPECIALS</span><span class="o">-</span><span class="mi">1</span> <span class="c1"># Reserved background colour</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CUTNETSIZE</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NETSIZE</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">SPECIALS</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MAXNETPOS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NETSIZE</span> <span class="o">-</span> <span class="mi">1</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">INITRAD</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NETSIZE</span><span class="o">/</span><span class="mi">8</span> <span class="c1"># For 256 colours, radius starts at 32</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RADIUSBIASSHIFT</span> <span class="o">=</span> <span class="mi">6</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RADIUSBIAS</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">RADIUSBIASSHIFT</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">INITBIASRADIUS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">INITRAD</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">RADIUSBIAS</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RADIUSDEC</span> <span class="o">=</span> <span class="mi">30</span> <span class="c1"># Factor of 1/30 each cycle</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">ALPHABIASSHIFT</span> <span class="o">=</span> <span class="mi">10</span> <span class="c1"># Alpha starts at 1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">INITALPHA</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">ALPHABIASSHIFT</span> <span class="c1"># biased by 10 bits</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">GAMMA</span> <span class="o">=</span> <span class="mf">1024.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BETA</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="mf">1024.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BETAGAMMA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">BETA</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">GAMMA</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">network</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">NETSIZE</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span> <span class="c1"># The network itself</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colormap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">NETSIZE</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int32&#39;</span><span class="p">)</span> <span class="c1"># The network itself</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">netindex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int32&#39;</span><span class="p">)</span> <span class="c1"># For network lookup - really 256</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">bias</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NETSIZE</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span> <span class="c1"># Bias and freq arrays for learning</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NETSIZE</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">pixels</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">samplefac</span> <span class="o">=</span> <span class="n">samplefac</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">a_s</span> <span class="o">=</span> <span class="p">{}</span></div>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">samplefac</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="mi">256</span><span class="p">):</span>
        
        <span class="c1"># Check Numpy</span>
        <span class="k">if</span> <span class="n">np</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Need Numpy for the NeuQuant algorithm.&quot;</span><span class="p">)</span>
        
        <span class="c1"># Check image</span>
        <span class="k">if</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">NeuQuant</span><span class="o">.</span><span class="n">MAXPRIME</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Image is too small&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">image</span><span class="o">.</span><span class="n">mode</span> <span class="o">!=</span> <span class="s2">&quot;RGBA&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Image mode should be RGBA.&quot;</span><span class="p">)</span>
        
        <span class="c1"># Initialize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setconstants</span><span class="p">(</span><span class="n">samplefac</span><span class="p">,</span> <span class="n">colors</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pixels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">tostring</span><span class="p">(),</span> <span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setUpArrays</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">learn</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fix</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inxbuild</span><span class="p">()</span>
    
<div class="viewcode-block" id="NeuQuant.writeColourMap"><a class="viewcode-back" href="../../../../all_module/airtest.report.images2gif.images2gif.html#airtest.report.images2gif.images2gif.NeuQuant.writeColourMap">[docs]</a>    <span class="k">def</span> <span class="nf">writeColourMap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rgb</span><span class="p">,</span> <span class="n">outstream</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NETSIZE</span><span class="p">):</span>
            <span class="n">bb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colormap</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">];</span>
            <span class="n">gg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colormap</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">];</span>
            <span class="n">rr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colormap</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">2</span><span class="p">];</span>
            <span class="n">outstream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">rr</span> <span class="k">if</span> <span class="n">rgb</span> <span class="k">else</span> <span class="n">bb</span><span class="p">)</span>
            <span class="n">outstream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">gg</span><span class="p">)</span>
            <span class="n">outstream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">bb</span> <span class="k">if</span> <span class="n">rgb</span> <span class="k">else</span> <span class="n">rr</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">NETSIZE</span></div>
    
<div class="viewcode-block" id="NeuQuant.setUpArrays"><a class="viewcode-back" href="../../../../all_module/airtest.report.images2gif.images2gif.html#airtest.report.images2gif.images2gif.NeuQuant.setUpArrays">[docs]</a>    <span class="k">def</span> <span class="nf">setUpArrays</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>    <span class="c1"># Black</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">255.0</span>    <span class="c1"># White</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">255.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">255.0</span>
    
        <span class="c1"># RESERVED self.BGCOLOR # Background</span>
    
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SPECIALS</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">NETSIZE</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bias</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SPECIALS</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">NETSIZE</span><span class="p">):</span>
            <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">p</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">255.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">SPECIALS</span><span class="p">))</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">CUTNETSIZE</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">NETSIZE</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bias</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>
    
    <span class="c1"># Omitted: setPixels</span>
    
<div class="viewcode-block" id="NeuQuant.altersingle"><a class="viewcode-back" href="../../../../all_module/airtest.report.images2gif.images2gif.html#airtest.report.images2gif.images2gif.NeuQuant.altersingle">[docs]</a>    <span class="k">def</span> <span class="nf">altersingle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Move neuron i towards biased (b,g,r) by factor alpha&quot;&quot;&quot;</span>
        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="c1"># Alter hit neuron</span>
        <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="p">(</span><span class="n">alpha</span><span class="o">*</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">b</span><span class="p">))</span>
        <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="p">(</span><span class="n">alpha</span><span class="o">*</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">g</span><span class="p">))</span>
        <span class="n">n</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-=</span> <span class="p">(</span><span class="n">alpha</span><span class="o">*</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">r</span><span class="p">))</span></div>
    
<div class="viewcode-block" id="NeuQuant.geta"><a class="viewcode-back" href="../../../../all_module/airtest.report.images2gif.images2gif.html#airtest.report.images2gif.images2gif.NeuQuant.geta">[docs]</a>    <span class="k">def</span> <span class="nf">geta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">rad</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">a_s</span><span class="p">[(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">rad</span><span class="p">)]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">length</span> <span class="o">=</span> <span class="n">rad</span><span class="o">*</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span>
            <span class="n">mid</span> <span class="o">=</span> <span class="n">length</span><span class="o">/</span><span class="mi">2</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">mid</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">+</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">mid</span><span class="p">)))</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">alpha</span><span class="o">*</span><span class="p">(</span><span class="n">rad</span><span class="o">*</span><span class="n">rad</span> <span class="o">-</span> <span class="n">q</span><span class="o">*</span><span class="n">q</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">rad</span><span class="o">*</span><span class="n">rad</span><span class="p">)</span>
            <span class="n">a</span><span class="p">[</span><span class="n">mid</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">a_s</span><span class="p">[(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">rad</span><span class="p">)]</span> <span class="o">=</span> <span class="n">a</span>
            <span class="k">return</span> <span class="n">a</span></div>
    
<div class="viewcode-block" id="NeuQuant.alterneigh"><a class="viewcode-back" href="../../../../all_module/airtest.report.images2gif.images2gif.html#airtest.report.images2gif.images2gif.NeuQuant.alterneigh">[docs]</a>    <span class="k">def</span> <span class="nf">alterneigh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">rad</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span><span class="o">-</span><span class="n">rad</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SPECIALS</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">lo</span> <span class="o">=</span> <span class="n">i</span><span class="o">-</span><span class="n">rad</span>
            <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SPECIALS</span><span class="o">-</span><span class="mi">1</span>
            <span class="n">start</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SPECIALS</span><span class="o">-</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">rad</span><span class="p">))</span>
            
        <span class="k">if</span> <span class="n">i</span><span class="o">+</span><span class="n">rad</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NETSIZE</span><span class="p">:</span>
            <span class="n">hi</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="n">rad</span>
            <span class="n">end</span> <span class="o">=</span> <span class="n">rad</span><span class="o">*</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">hi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NETSIZE</span>
            <span class="n">end</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NETSIZE</span> <span class="o">-</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">rad</span><span class="p">))</span>
        
        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geta</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">rad</span><span class="p">)[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
        
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="p">[</span><span class="n">lo</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">hi</span><span class="p">]</span>
        <span class="n">p</span> <span class="o">-=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">b</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">r</span><span class="p">]))</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span></div>
        
    <span class="c1">#def contest(self, b, g, r):</span>
    <span class="c1">#    &quot;&quot;&quot; Search for biased BGR values</span>
    <span class="c1">#            Finds closest neuron (min dist) and updates self.freq</span>
    <span class="c1">#            finds best neuron (min dist-self.bias) and returns position</span>
    <span class="c1">#            for frequently chosen neurons, self.freq[i] is high and self.bias[i] is negative</span>
    <span class="c1">#            self.bias[i] = self.GAMMA*((1/self.NETSIZE)-self.freq[i])&quot;&quot;&quot;</span>
    <span class="c1">#</span>
    <span class="c1">#    i, j = self.SPECIALS, self.NETSIZE</span>
    <span class="c1">#    dists = abs(self.network[i:j] - np.array([b,g,r])).sum(1)</span>
    <span class="c1">#    bestpos = i + np.argmin(dists)</span>
    <span class="c1">#    biasdists = dists - self.bias[i:j]</span>
    <span class="c1">#    bestbiaspos = i + np.argmin(biasdists)</span>
    <span class="c1">#    self.freq[i:j] -= self.BETA * self.freq[i:j]</span>
    <span class="c1">#    self.bias[i:j] += self.BETAGAMMA * self.freq[i:j]</span>
    <span class="c1">#    self.freq[bestpos] += self.BETA</span>
    <span class="c1">#    self.bias[bestpos] -= self.BETAGAMMA</span>
    <span class="c1">#    return bestbiaspos</span>
<div class="viewcode-block" id="NeuQuant.contest"><a class="viewcode-back" href="../../../../all_module/airtest.report.images2gif.images2gif.html#airtest.report.images2gif.images2gif.NeuQuant.contest">[docs]</a>    <span class="k">def</span> <span class="nf">contest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Search for biased BGR values</span>
<span class="sd">                Finds closest neuron (min dist) and updates self.freq</span>
<span class="sd">                finds best neuron (min dist-self.bias) and returns position</span>
<span class="sd">                for frequently chosen neurons, self.freq[i] is high and self.bias[i] is negative</span>
<span class="sd">                self.bias[i] = self.GAMMA*((1/self.NETSIZE)-self.freq[i])&quot;&quot;&quot;</span>
        <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SPECIALS</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">NETSIZE</span>
        <span class="n">dists</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">b</span><span class="p">,</span><span class="n">g</span><span class="p">,</span><span class="n">r</span><span class="p">]))</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">bestpos</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">dists</span><span class="p">)</span>
        <span class="n">biasdists</span> <span class="o">=</span> <span class="n">dists</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">bias</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">j</span><span class="p">]</span>
        <span class="n">bestbiaspos</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">biasdists</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">j</span><span class="p">]</span> <span class="o">*=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">BETA</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bias</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">BETAGAMMA</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">j</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="p">[</span><span class="n">bestpos</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">BETA</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bias</span><span class="p">[</span><span class="n">bestpos</span><span class="p">]</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">BETAGAMMA</span>
        <span class="k">return</span> <span class="n">bestbiaspos</span></div>
    



<div class="viewcode-block" id="NeuQuant.specialFind"><a class="viewcode-back" href="../../../../all_module/airtest.report.images2gif.images2gif.html#airtest.report.images2gif.images2gif.NeuQuant.specialFind">[docs]</a>    <span class="k">def</span> <span class="nf">specialFind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SPECIALS</span><span class="p">):</span>
            <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">b</span> <span class="ow">and</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">g</span> <span class="ow">and</span> <span class="n">n</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">r</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">i</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span></div>
    
<div class="viewcode-block" id="NeuQuant.learn"><a class="viewcode-back" href="../../../../all_module/airtest.report.images2gif.images2gif.html#airtest.report.images2gif.images2gif.NeuQuant.learn">[docs]</a>    <span class="k">def</span> <span class="nf">learn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">biasRadius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">INITBIASRADIUS</span>
        <span class="n">alphadec</span> <span class="o">=</span> <span class="mi">30</span> <span class="o">+</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">samplefac</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">lengthcount</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixels</span><span class="o">.</span><span class="n">size</span>
        <span class="n">samplepixels</span> <span class="o">=</span> <span class="n">lengthcount</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">samplefac</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="n">samplepixels</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">NCYCLES</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">INITALPHA</span>
        
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">rad</span> <span class="o">=</span> <span class="n">biasRadius</span> <span class="o">&gt;&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">RADIUSBIASSHIFT</span>
        <span class="k">if</span> <span class="n">rad</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">rad</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Beginning 1D learning: samplepixels = </span><span class="si">%1.2f</span><span class="s2">  rad = </span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span>
                                                    <span class="p">(</span><span class="n">samplepixels</span><span class="p">,</span> <span class="n">rad</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">step</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">lengthcount</span><span class="o">%</span><span class="n">NeuQuant</span><span class="o">.</span><span class="n">PRIME1</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="n">NeuQuant</span><span class="o">.</span><span class="n">PRIME1</span>
        <span class="k">elif</span> <span class="n">lengthcount</span><span class="o">%</span><span class="n">NeuQuant</span><span class="o">.</span><span class="n">PRIME2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="n">NeuQuant</span><span class="o">.</span><span class="n">PRIME2</span>
        <span class="k">elif</span> <span class="n">lengthcount</span><span class="o">%</span><span class="n">NeuQuant</span><span class="o">.</span><span class="n">PRIME3</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="n">NeuQuant</span><span class="o">.</span><span class="n">PRIME3</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="n">NeuQuant</span><span class="o">.</span><span class="n">PRIME4</span>
    
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">printed_string</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">samplepixels</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">%</span><span class="mi">100</span> <span class="o">==</span> <span class="mi">99</span><span class="p">:</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\b</span><span class="s1">&#39;</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">printed_string</span><span class="p">)</span>
                <span class="n">printed_string</span> <span class="o">=</span> <span class="nb">str</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="o">/</span><span class="n">samplepixels</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;%</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">tmp</span> <span class="o">+</span> <span class="n">printed_string</span><span class="p">)</span>
            <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixels</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span>
            <span class="n">r</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span>
            <span class="n">g</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">&gt;&gt;</span>  <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span>
            <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span>      <span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span>
    
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># Remember background colour</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">BGCOLOR</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">b</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">r</span><span class="p">]</span>
    
            <span class="n">j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">specialFind</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">contest</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">j</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SPECIALS</span><span class="p">:</span> <span class="c1"># Don&#39;t learn for specials</span>
                <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">INITALPHA</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">altersingle</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">rad</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">alterneigh</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">rad</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
    
            <span class="n">pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">pos</span><span class="o">+</span><span class="n">step</span><span class="p">)</span><span class="o">%</span><span class="n">lengthcount</span>
            
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">%</span><span class="n">delta</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">alpha</span> <span class="o">-=</span> <span class="n">alpha</span> <span class="o">/</span> <span class="n">alphadec</span>
                <span class="n">biasRadius</span> <span class="o">-=</span> <span class="n">biasRadius</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">RADIUSDEC</span>
                <span class="n">rad</span> <span class="o">=</span> <span class="n">biasRadius</span> <span class="o">&gt;&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">RADIUSBIASSHIFT</span>
                <span class="k">if</span> <span class="n">rad</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">rad</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="n">finalAlpha</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">*</span><span class="n">alpha</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">INITALPHA</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Finished 1D learning: final alpha = </span><span class="si">%1.2f</span><span class="s2">!&quot;</span> <span class="o">%</span> <span class="n">finalAlpha</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="NeuQuant.fix"><a class="viewcode-back" href="../../../../all_module/airtest.report.images2gif.images2gif.html#airtest.report.images2gif.images2gif.NeuQuant.fix">[docs]</a>    <span class="k">def</span> <span class="nf">fix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NETSIZE</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                <span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">])</span>
                <span class="n">x</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">colormap</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">colormap</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span></div>
    
<div class="viewcode-block" id="NeuQuant.inxbuild"><a class="viewcode-back" href="../../../../all_module/airtest.report.images2gif.images2gif.html#airtest.report.images2gif.images2gif.NeuQuant.inxbuild">[docs]</a>    <span class="k">def</span> <span class="nf">inxbuild</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">previouscol</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">startpos</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NETSIZE</span><span class="p">):</span>
            <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colormap</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">q</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">smallpos</span> <span class="o">=</span> <span class="n">i</span>
            <span class="n">smallval</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># Index on g</span>
            <span class="c1"># Find smallest in i..self.NETSIZE-1</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">NETSIZE</span><span class="p">):</span>
                <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colormap</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">smallval</span><span class="p">:</span> <span class="c1"># Index on g</span>
                    <span class="n">smallpos</span> <span class="o">=</span> <span class="n">j</span>
                    <span class="n">smallval</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># Index on g</span>
            
            <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colormap</span><span class="p">[</span><span class="n">smallpos</span><span class="p">]</span>
            <span class="c1"># Swap p (i) and q (smallpos) entries</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">smallpos</span><span class="p">:</span>
                <span class="n">p</span><span class="p">[:],</span><span class="n">q</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">q</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            
            <span class="c1"># smallval entry is now in position i</span>
            <span class="k">if</span> <span class="n">smallval</span> <span class="o">!=</span> <span class="n">previouscol</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">netindex</span><span class="p">[</span><span class="n">previouscol</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">startpos</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">previouscol</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">smallval</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">netindex</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
                <span class="n">previouscol</span> <span class="o">=</span> <span class="n">smallval</span>
                <span class="n">startpos</span> <span class="o">=</span> <span class="n">i</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">netindex</span><span class="p">[</span><span class="n">previouscol</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">startpos</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">MAXNETPOS</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">previouscol</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">256</span><span class="p">):</span> <span class="c1"># Really 256</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">netindex</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MAXNETPOS</span></div>
    
    
<div class="viewcode-block" id="NeuQuant.paletteImage"><a class="viewcode-back" href="../../../../all_module/airtest.report.images2gif.images2gif.html#airtest.report.images2gif.images2gif.NeuQuant.paletteImage">[docs]</a>    <span class="k">def</span> <span class="nf">paletteImage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; PIL weird interface for making a paletted image: create an image which</span>
<span class="sd">            already has the palette, and use that in Image.quantize. This function</span>
<span class="sd">            returns this palette image. &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pimage</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">palette</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NETSIZE</span><span class="p">):</span>
                <span class="n">palette</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colormap</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="mi">3</span><span class="p">])</span>
                
            <span class="n">palette</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">256</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">NETSIZE</span><span class="p">)</span><span class="o">*</span><span class="mi">3</span><span class="p">)</span>
            
            <span class="c1"># a palette image to use for quant</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pimage</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;P&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pimage</span><span class="o">.</span><span class="n">putpalette</span><span class="p">(</span><span class="n">palette</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pimage</span></div>
    
    
<div class="viewcode-block" id="NeuQuant.quantize"><a class="viewcode-back" href="../../../../all_module/airtest.report.images2gif.images2gif.html#airtest.report.images2gif.images2gif.NeuQuant.quantize">[docs]</a>    <span class="k">def</span> <span class="nf">quantize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Use a kdtree to quickly find the closest palette colors for the pixels &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">get_cKDTree</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantize_with_scipy</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Scipy not available, falling back to slower version.&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantize_without_scipy</span><span class="p">(</span><span class="n">image</span><span class="p">)</span></div>
    
    
<div class="viewcode-block" id="NeuQuant.quantize_with_scipy"><a class="viewcode-back" href="../../../../all_module/airtest.report.images2gif.images2gif.html#airtest.report.images2gif.images2gif.NeuQuant.quantize_with_scipy">[docs]</a>    <span class="k">def</span> <span class="nf">quantize_with_scipy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">):</span>
        <span class="n">w</span><span class="p">,</span><span class="n">h</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span>
        <span class="n">px</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">image</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">px2</span> <span class="o">=</span> <span class="n">px</span><span class="p">[:,:,:</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">w</span><span class="o">*</span><span class="n">h</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
        
        <span class="n">cKDTree</span> <span class="o">=</span> <span class="n">get_cKDTree</span><span class="p">()</span>
        <span class="n">kdtree</span> <span class="o">=</span> <span class="n">cKDTree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colormap</span><span class="p">[:,:</span><span class="mi">3</span><span class="p">],</span><span class="n">leafsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">kdtree</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">px2</span><span class="p">)</span>
        <span class="n">colorindex</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Distance: </span><span class="si">%1.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">/</span><span class="p">(</span><span class="n">w</span><span class="o">*</span><span class="n">h</span><span class="p">))</span> <span class="p">)</span>
        <span class="n">px2</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colormap</span><span class="p">[</span><span class="n">colorindex</span><span class="p">,:</span><span class="mi">3</span><span class="p">]</span>
        
        <span class="k">return</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">px</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">&quot;RGB&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">quantize</span><span class="p">(</span><span class="n">palette</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">paletteImage</span><span class="p">())</span></div>
    
    
<div class="viewcode-block" id="NeuQuant.quantize_without_scipy"><a class="viewcode-back" href="../../../../all_module/airtest.report.images2gif.images2gif.html#airtest.report.images2gif.images2gif.NeuQuant.quantize_without_scipy">[docs]</a>    <span class="k">def</span> <span class="nf">quantize_without_scipy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot; This function can be used if no scipy is availabe. </span>
<span class="sd">        It&#39;s 7 times slower though.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">w</span><span class="p">,</span><span class="n">h</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span>
        <span class="n">px</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">image</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">memo</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">w</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">h</span><span class="p">):</span>
                <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">px</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">px</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">px</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="n">memo</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="o">*</span><span class="n">key</span><span class="p">)</span>
                    <span class="n">memo</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
                <span class="n">px</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">px</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">px</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
        <span class="k">return</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">px</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">&quot;RGB&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">quantize</span><span class="p">(</span><span class="n">palette</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">paletteImage</span><span class="p">())</span></div>
    
<div class="viewcode-block" id="NeuQuant.convert"><a class="viewcode-back" href="../../../../all_module/airtest.report.images2gif.images2gif.html#airtest.report.images2gif.images2gif.NeuQuant.convert">[docs]</a>    <span class="k">def</span> <span class="nf">convert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">color</span><span class="p">):</span>
        <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inxsearch</span><span class="p">(</span><span class="o">*</span><span class="n">color</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">colormap</span><span class="p">[</span><span class="n">i</span><span class="p">,:</span><span class="mi">3</span><span class="p">]</span></div>
    
<div class="viewcode-block" id="NeuQuant.inxsearch"><a class="viewcode-back" href="../../../../all_module/airtest.report.images2gif.images2gif.html#airtest.report.images2gif.images2gif.NeuQuant.inxsearch">[docs]</a>    <span class="k">def</span> <span class="nf">inxsearch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Search for BGR values 0..255 and return colour index&quot;&quot;&quot;</span>
        <span class="n">dists</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colormap</span><span class="p">[:,:</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">r</span><span class="p">,</span><span class="n">g</span><span class="p">,</span><span class="n">b</span><span class="p">]))</span>
        <span class="n">a</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">((</span><span class="n">dists</span><span class="o">*</span><span class="n">dists</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">a</span></div></div>



<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">200</span><span class="p">,</span><span class="mi">200</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
    <span class="n">im</span><span class="p">[</span><span class="mi">10</span><span class="p">:</span><span class="mi">30</span><span class="p">,:]</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">im</span><span class="p">[:,</span><span class="mi">80</span><span class="p">:</span><span class="mi">120</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span>
    <span class="n">im</span><span class="p">[</span><span class="o">-</span><span class="mi">50</span><span class="p">:</span><span class="o">-</span><span class="mi">40</span><span class="p">,:]</span> <span class="o">=</span> <span class="mi">50</span>
    
    <span class="n">images</span> <span class="o">=</span> <span class="p">[</span><span class="n">im</span><span class="o">*</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">im</span><span class="o">*</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">im</span><span class="o">*</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">im</span><span class="o">*</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">im</span><span class="o">*</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">writeGif</span><span class="p">(</span><span class="s1">&#39;lala3.gif&#39;</span><span class="p">,</span><span class="n">images</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">dither</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>

           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Game-Netease.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>